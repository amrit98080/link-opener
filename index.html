<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opening App...</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZZPDXZFZGC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZZPDXZFZGC');
    </script>
</head>
<body style="background: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0;">
    
    <div style="text-align: center;">
        <div style="border: 4px solid #f3f3f3; border-top: 4px solid #ff0000; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
        <p style="color: #666; font-size: 14px;">Redirecting you to the app...</p>
    </div>

    <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const ytId = urlParams.get('v');      // YouTube Video
        const ytChan = urlParams.get('c');    // YouTube Channel
        const igUser = urlParams.get('ig');    // Instagram Profile/Reel
        const contentTitle = urlParams.get('title') || "Unknown_Content";

        const isAndroid = /Android/i.test(navigator.userAgent);
        const isiOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        // Safety Switch: Prevents double-redirect glitches
        let redirected = false; 

        function performRedirect() {
            if (redirected) return;
            redirected = true;

            // 1. YOUTUBE VIDEO
            if (ytId) {
                const webUrl = "https://www.youtube.com/watch?v=" + ytId;
                if (isAndroid) {
                    window.location.href = "intent://www.youtube.com/watch?v=" + ytId + "#Intent;scheme=https;package=com.google.android.youtube;end;";
                } else if (isiOS) {
                    window.location.href = "youtube://www.youtube.com/watch?v=" + ytId;
                }
                setTimeout(() => { window.location.href = webUrl; }, 150);

            // 2. YOUTUBE CHANNEL
            } else if (ytChan) {
                const webUrl = "https://www.youtube.com/" + ytChan;
                if (isAndroid) {
                    window.location.href = "intent://www.youtube.com/" + ytChan + "#Intent;scheme=https;package=com.google.android.youtube;end;";
                } else if (isiOS) {
                    window.location.href = "youtube://www.youtube.com/" + ytChan;
                }
                setTimeout(() => { window.location.href = webUrl; }, 150);

            // 3. INSTAGRAM
            } else if (igUser) {
                const webUrl = "https://www.instagram.com/" + igUser + "/";
                if (isAndroid) {
                    window.location.href = "intent://www.instagram.com/_u/" + igUser + "/#Intent;scheme=https;package=com.instagram.android;end;";
                } else if (isiOS) {
                    window.location.href = "instagram://user?username=" + igUser;
                }
                setTimeout(() => { window.location.href = webUrl; }, 150);

            // 4. FALLBACK
            } else {
                window.location.href = "https://www.youtube.com/";
            }
        }

        // --- ðŸ“Š ANALYTICS TRACKING ---
        const type = ytId ? "youtube_video" : (ytChan ? "youtube_channel" : (igUser ? "instagram_profile" : "none"));
        const value = ytId || ytChan || igUser || "default";

        if (type !== "none") {
            gtag('event', 'deep_link_click', {
                'platform': type,
                'target_id': value,
                'content_name': contentTitle, 
                'event_callback': function() { performRedirect(); }
            });
            // Backup redirect if analytics is slow
            setTimeout(performRedirect, 1500);
        } else {
            performRedirect();
        }
    </script>
</body>
</html>
